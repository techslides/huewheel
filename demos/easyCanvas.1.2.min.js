/*
 *	EasyCanvas version 1.2
 *	Ken Fyrstenberg Nilsen, (c) 2013 Abidas Software
 *	http://easyCanvasJS.com/
 *	GPL-3.0 license (http://opensource.org/licenses/GPL-3.0)
*/
"use strict";function easyCanvas(){var ak=this,aS,Z,L,ab=0,D,av=0,ax=0,aw=0,au=0,az=180/Math.PI,H=Math.PI/180,aT=1,aU=1,aE=0,aO=0,aP=0,ar=0,at=0,C,u=!0,aA=!1,aL,aN,aQ,aR,z=!1,x,y,aq,ao,v=null,am=null,ap,aH,aF=0,aG=!1,ae=!1,I=[".jpg",".jpeg",".png",".gif",".svg",".tif",".tiff",".bmp"],K=-1,J=-1,F=0,G=[0],aC=[],E=null,aa=[],X=0,Y=0,V=0,W=0,O=!1,an,ay=["","webkit","moz","ms","o","khtml"],U=!0,ah=!0,aj=!1,ai,aM,ag=(typeof window.console.__mozillaConsole__!=="undefined"),ad=(typeof window.chrome!=="undefined"),n=25;this.canvas=null;this.onmousedown=null;this.onmousemove=null;this.onmouseup=null;this.onredraw=null;this.onmousewheel=null;this.ondrop=null;this.ondropprogress=null;this.onselect=null;this.onselectend=null;this.onselectstart=null;this.reportResize=!0;this.calcAngle=!1;this.calcDistance=!1;this.calcVelocity=!1;this.autoResize=!1;this.trackMove=!1;this.clearColor=null;this.clearBeforeDraw=!0;this.autoClear=!1;this.selectionMode=!1;this.selectedRect=null;this.selectClearFull=!1;this.fullScreenMode=0;this.enableRegions=!1;this.width;this.height;this.deltaX=0;this.deltaY=0;this.firstX=-1;this.firstY=-1;this.prevX=-1;this.prevY=-1;this.prevAngle=-1;this.prevStamp=null;this.count=0;this.pivotX=0.5;this.pivotY=0.5;this.panMode=!1;this.limitPan=!0;this.panCursor="move";this.record=!1;this.tool=0;this.strokes=[];this.strokeHeader=null;this.deg2rad=H;this.rad2deg=az;this.total=0;this.isDown=!1;this.maxVel=0;this.oldCursor;this.isCursor=!1;if(arguments.length>0){for(;aM=arguments[ab];ab++){if(typeof aM==="number"){ah===!0?this.width=aS=parseInt(aM,10):this.height=Z=parseInt(aM,10);ah=!1}if(typeof aM==="string"){L=document.getElementById(aM);if(L instanceof HTMLCanvasElement){this.canvas=L;this.width=this.canvas.width;this.height=this.canvas.height}}if(aM instanceof HTMLCanvasElement){this.canvas=aM;this.width=this.canvas.width;this.height=this.canvas.height}if(aM instanceof HTMLElement){L=aM}}}this.resize=function(aW,aV){if(typeof aW!=="number"||typeof aV!=="number"){return f("Illegal numbers for width or height.","resize")}try{this.canvas.width=parseInt(aW,10)-(av+aw);this.canvas.height=parseInt(aV,10)-(ax+au);this.canvas.style.marginLeft=av+"px";this.canvas.style.marginTop=ax+"px";this.width=this.canvas.width;this.height=this.canvas.height;if(D!==undefined){B();aK()}aB();if(v!==null){v=ak.getOffScreenCanvas()}}catch(i){return f("Error when resizing instance","resize")}return this};this.padding=function(aV,w,h,i){if(arguments.length===0){return[ax,aw,au,av]}ax=aV;aw=w;au=h;av=i;this.resize(this.canvas.width,this.canvas.height);return this};this.clear=function(){D.save();D.setTransform(1,0,0,1,0,0);if(this.clearColor===null){D.clearRect(0,0,this.canvas.width,this.canvas.height)}else{D.fillStyle=this.clearColor;D.fillRect(0,0,this.canvas.width,this.canvas.height)}D.restore();return this};this.remove=function(){try{var h=this.canvas;if(typeof L!=="undefined"&&L!==null&&typeof L!=="string"){if(ae===!0){this.canvas.removeEventListener("dragover",d,!1);this.canvas.removeEventListener("drop",e,!1)}document.removeEventListener("fullscreenchange",g,!1);document.removeEventListener("mozfullscreenchange",g,!1);document.removeEventListener("webkitfullscreenchange",g,!1);window.removeEventListener("resize",s,!1);window.removeEventListener("mouseup",q,!1);this.canvas.removeEventListener(ag?"DOMMouseScroll":"mousewheel",r,!1);if(U===!0){window.removeEventListener("mousemove",p,!1)}h.onmousedown=null;h.onmousemove=null;h.onmouseup=null;h.onselectstart=null;h.onselect=null;h.onselectend=null;h.ondrop=null;h.ondropprogress=null;h.onmousewheel=null;if(!(L instanceof HTMLCanvasElement)){L.removeChild(h)}D=this.ctx=this.context=undefined;this.canvas=undefined}}catch(i){return f("Error removing instance","remove")}};this.style=function(i,h){if(arguments.length===1){return this.canvas.style[i]}this.canvas.style[i]=h;return this};this.cssClass=function(h){if(arguments.length===0){return this.canvas.className}if(h===null){h=""}this.canvas.className=h;return this};this.download=function(aV,aW,h){if(typeof aV!=="string"||aV.trim().length===0){aV="Untitled"}aW=(typeof aW==="string")?aW.toLowerCase():"png";if(aV.length<5||aV.substring(aV.length-aW.length)!==aW){aV+="."+aW}var aX=document.createElement("a"),i=this.canvas,w;aX.download=aV;if(aW==="png"){aX.href=i.toDataURL()}else{if(aW==="jpg"||aW==="jpeg"){(typeof h==="number")?aX.href=i.toDataURL("image/jpeg",h):aX.href=i.toDataURL("image/jpeg")}}if(document.createEvent){w=document.createEvent("MouseEvents");w.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);aX.dispatchEvent(w)}else{if(aX.fireEvent){aX.fireEvent("onclick")}}return this};this.clipCoords=function(i){if(typeof i!=="boolean"){return !U}var h=this.canvas;if(i!==U){return this}if(i===!0){window.removeEventListener("mousemove",p,!1);h.onmousemove=p}else{h.onmousemove=null;window.addEventListener("mousemove",p,!1)}U=!i;return this};this.zoom=function(aW,aX,w,aV){if(aW===undefined){return[aT,aU]}if(typeof aX!=="number"){aX=aW}if(aW<0.0001){aW=0.0001}if(aX<0.0001){aX=0.0001}if(aT===aW&&aU===aX){return this}if(typeof ak.onbeforezoom==="function"){ak.onbeforezoom({oldZoomX:aT,oldZoomY:aU,newZoomX:aW,newZoomY:aX,timeStamp:S()})}var h=aT,i=aU;aT=aW;aU=aX;aK();if(typeof ak.onzoom==="function"){ak.onzoom({oldZoomX:h,oldZoomY:i,newZoomX:aW,newZoomY:aX,timeStamp:S()})}return this};this.rotate=function(h){if(arguments.length===0){return h}h=parseFloat(h);if(h===aE){return this}if(typeof ak.onbeforerotate==="function"){ak.onbeforerotate({oldAngle:aE,newAngle:h,timeStamp:S()})}while(h<0){h+=360}while(h>=360){h-=360}var i=aE;aE=h;aK();if(typeof ak.onrotate==="function"){ak.onrotate({oldAngle:i,newAngle:h,timeStamp:S()})}return this};this.pan=function(i,w,h){if(arguments.length===0){return[aO,aP,ar,at]}h=(typeof h==="boolean")?h:!1;if(typeof ak.onbeforepan==="function"){ak.onbeforepan({oldDeltaX:aO,oldDeltaY:aP,newDeltaX:i,newDeltaY:w,isAbsolute:h,timeStamp:S()})}var aV=aO,aW=aP;if(h===!0){aO=i;aP=w}else{aO+=i;aP+=w}aK();if(typeof ak.onpan==="function"){ak.onpan({oldDeltaX:aV,oldDeltaY:aW,newDeltaX:aO,newDeltaY:aP,isAbsolute:h,timeStamp:S()})}return this};this.reset=function(){aT=aU=1;aE=aO=aP=ar=at=0;aK();return this};this.strokeLine=this.line=function(aV,aX,aW,aY,w,h){var i=arguments.length;D.beginPath();D.moveTo(aV,aX);D.lineTo(aW,aY);if(i>4){D.lineWidth=w}if(i>5){D.strokeStyle=h}D.stroke();return this};this.update=function(){aB()};this.grid=function(h,i,w,aV){switch(arguments.length){case 0:return[X,Y,V,W];case 1:i=h;w=aV=0;break;case 2:w=aV=0;break;case 3:aV=w;break;case 4:break;case Default:return f("Unsupported number of arguments.","grid")}if(h<0){h=0}if(i<0){i=0}X=h;Y=i;V=w;W=aV;return this};this.getGridX=function(h){if(X===0){return h}if(h<V){h=V}return(((h+X*0.5-V)/X)|0)*X+V};this.getGridY=function(h){if(Y===0){return h}if(h<W){h=W}return(((h+Y*0.5-W)/Y)|0)*Y+W};this.getGridCell=function(h,i){h=((h-V)/X)|0;i=((i-W)/Y)|0;return[h,i]};this.getGridPosition=function(h,i){h=parseInt(h,10);i=parseInt(i,10);if(h<0){h=0}if(i<0){i=0}h=h*X+V;i=i*Y+W;return[h,i]};this.lock=function(i){if(arguments.length===0){return z}if(i===z){return this}z=i;try{if(i===!0){ao=this.getPixel;aq=this.setPixel;this.getPixel=R;this.setPixel=aJ;x=D.getImageData(0,0,this.canvas.width,this.canvas.height);y=x.data}else{this.getPixel=ao;this.setPixel=aq;D.putImageData(x,0,0)}}catch(h){return f(h.message||"Security error probably due to CORS restrictions","lock")}return this};function R(i,w){var h=x.width*w*4+i*4;return[y[h],y[h+1],y[h+2],y[h+3]]}function aJ(w,aV,h){var i=x.width*aV*4+w*4;y[i]=h[0];y[i+1]=h[1];y[i+2]=h[2];if(h.length===4){y[i+3]=h[3]}return this}this.getPixel=function(w,aV){try{var i=D.getImageData(w,aV,1,1).data;return[i[0],i[1],i[2],i[3]]}catch(h){return f(h.message||"Security error probably due to CORS restrictions","getPixel")}};this.setPixel=function(aX,aY,h){if(h.length===3){h.push(255)}var aV,i,aW;try{aV=D.getImageData(aX,aY,1,1);i=aV.data;i[0]=h[0];i[1]=h[1];i[2]=h[2];i[3]=h[3];D.putImageData(aV,aX,aY);return this}catch(w){aW=D.fillStyle;D.fillStyle="rgba("+h[0]+","+h[1]+","+h[2]+","+(h[3]/255).toFixed(2)+")";D.fillRect(aX,aY,1,1);D.fillStyle=aW;return f(w.message||"Security error probably due to CORS restrictions.","setPixel")}};this.drawImageProp=function(a1,a9,ba,a8,aZ,a5,a6){if(typeof a1==="undefined"||a1===null){return f("Image argument is null or undefined","drawImageProp")}if(arguments.length===1){a9=ba=0;a8=this.width;aZ=this.height;a5=0.5;a6=0.5}a5=(typeof a5==="number")?a5:0.5;a6=(typeof a6==="number")?a6:0.5;if(a5<0){a5=0}if(a6<0){a6=0}if(a5>1){a5=1}if(a6>1){a6=1}var a2=a1.width,a0=a1.height,a7=Math.min(a8/a2,aZ/a0),a4=a2*a7,a3=a0*a7,aX,aY,aW,aV,i=1;if(a4<a8){i=a8/a4}if(a3<aZ){i=aZ/a3}a4*=i;a3*=i;aW=a2*1/(a4/a8);aV=a0*1/(a3/aZ);aX=(a2-aW)*a5;aY=(a0-aV)*a6;if(aX<0){aX=0}if(aY<0){aY=0}if(aW>a2){aW=a2}if(aV>a0){aV=a0}D.drawImage(a1,aX,aY,aW,aV,a9,ba,a8,aZ);return this};this.antialiasing=function(aX){if(arguments.length===0){return u}u=aX;var w=!1,aV,h=0,aW=";image-rendering:";for(;h<ay.length;h++){aV=(h===0)?"imageSmoothingEnabled":ay[h]+"ImageSmoothingEnabled";if(D[aV]!==undefined){D[aV]=u;w=!0;break}}if(w===!1){this.canvas.style.cssText=(u===!0)?aW+"-moz-auto"+aW+"-webkit-auto"+aW+"-o-auto"+aW+"auto;-ms-interpolation-mode:bicubic;":aW+"-moz-crisp-edges"+aW+"-webkit-optimize-contrast"+aW+"-o-crisp-edges"+aW+"crisp-edges;-ms-interpolation-mode:nearest-neighbor;"}return this};this.getOffscreenCanvas=this.getOffScreenCanvas=function(aX,aV){var i=document.createElement("canvas"),aW,aY;if(arguments.length===0){aX=this.canvas.width;aV=this.canvas.height}else{if(arguments.length===1&&typeof aX!=="number"){if(typeof aX.width==="undefined"&&typeof aX.clientWidth==="undefined"){return f("Invalid arguments","getOffScreenCanvas")}aW=aX;aX=aW.width||aW.clientWidth;aV=aW.height||aW.clientHeight}}i.width=aX;i.height=aV;aY=i.getContext("2d");if(typeof aW!=="undefined"){aY.drawImage(aW,0,0)}return{canvas:i,ctx:aY,context:aY,width:aX,height:aV,centerX:aX*0.5,centerY:aV*0.5}};this.loadImage=function(aV,h,i){if(typeof aV!=="string"){return f("An URL must be provided","loadImage")}if(typeof h!=="function"){return f("A callback function for loadImage success must be provided.","loadImage")}var w=document.createElement("img");w.onload=function(aW){h({image:this,url:aV,timeStamp:aW.timeStamp})};if(typeof i==="function"){w.onerror=function(aW){i({image:null,url:aV,timeStamp:S()})}}else{w.onerror=function(aW){f("Error loading image","loadImage")}}w.src=aV;return this};this.loadImages=function(a1,h,a0){if(!Array.isArray(a1)||a1.length===0){return f("URL must be provided","loadImages")}if(typeof h!=="function"){return f("A callback function for loadImage success must be provided.","loadImages")}var aW=a1.length,aZ=aW,aY=new Array(aW),aX=0;if(typeof a0==="function"){a0({current:0,total:aZ,image:null,timeStamp:S()})}for(;aX<aZ;aX++){this.loadImage(a1[aX],w,aV)}function w(i,a2){for(var a3=0;a3<aZ;a3++){if(i.url===a1[a3]){break}}aY[a3]=(arguments.length===1)?i.image:null;aW--;if(typeof a0==="function"){a0({current:aZ-aW,total:aZ,image:aY[a3],timeStamp:i.timeStamp})}if(aW===0){h({images:aY,urls:a1,timeStamp:S()})}}function aV(i){w(i,1)}return this};this.getVelocity=function(aW){if(aQ.length===0){return 0}if(aQ.length===1){return aQ[0]}aW=(typeof aW==="number")?parseInt(aW,10):3;if(aW>aQ.length){aW=aQ.count}var aV=0,aX=0,h=0,w=1,aY;for(;aV<aW;aV++){aX+=(aV+1)}aV=aQ.length-aW;for(;aY=aQ[aV];aV++){h+=aQ[aV]*w/aX;w++}return h};this.renderTool0=function(h,aW){D.beginPath();if(typeof aW==="number"){D.lineWidth=aW}if(typeof h==="string"){D.strokeStyle=h}var w=0,aZ,aY,aV,aX;for(;aY=this.strokes[w];w++){if(aY[0]===0){aV=aY.length;aX=(aV*0.5===((aV*0.5)|0))?aX=2:1;D.moveTo(aY[aX],aY[aX+1]);for(aZ=aX+2;aZ<aV;aZ+=2){D.lineTo(aY[aZ],aY[aZ+1])}}}D.stroke();return this};this.getRect=function(aV,aX,aW,aY,w){w=(typeof w==="boolean")?w:!0;var h=aW-aV,i=aY-aX;aV=(h<0)?aW:aV;aX=(i<0)?aY:aX;return(w===!0)?[aV,aX,Math.abs(h)+1,Math.abs(i)+1]:[aV,aX,Math.abs(h),Math.abs(i)]};this.startAutoClear=function(){if(typeof v==="undefined"||v===null){ac()}return this};this.updateAutoClear=function(){if(v!==null){v.ctx.drawImage(ak.canvas,0,0)}return this};this.getAutoClearBuffer=function(){return v};this.clearBackground=function(aX,aY,aW,aV){if(v!==null){if(aX===null){return}if(arguments.length===0){aX=aY=0;aW=ak.width;aV=ak.height}else{if(arguments.length===1){aY=aX[1];aW=aX[2];aV=aX[3];aX=aX[0]}}aX=parseInt(aX,10);aY=parseInt(aY,10);aW=parseInt(aW,10);aV=parseInt(aV,10);aX-=2;aY-=2;aW+=5;aV+=5;ak.ctx.clearRect(aX,aY,aW,aV);if(aX<0){aX=0}if(aY<0){aY=0}if(aX>=ak.width){aX=ak.width-1}if(aY>=ak.height){aY=ak.height-1}if(aW+aX>ak.width){aW=ak.width-aX}if(aV+aY>ak.height){aV=ak.height-aY}if(aW<1){aW=1}if(aV<1){aV=1}try{ak.ctx.drawImage(v.canvas,aX,aY,aW,aV,aX,aY,aW,aV)}catch(i){return f(i.message||"Error occured","clearBackground")}}return this};this.endAutoClear=function(){if(v!==null){v=null}return this};this.setDash=function(w,i,h){if(arguments.length===0){return[G,F]}i=(typeof i==="number")?i:0;if(typeof w==="number"){w=[w,w]}if(w.length<2){w.push(w[0])}if(arguments.length<3){F=i;G=w}if(typeof D.setLineDash!=="undefined"){ak.ctx.setLineDash(w);ak.ctx.lineDashOffset=i}else{if(typeof D.mozDash!=="undefined"){ak.ctx.mozDash=[5,5];ak.ctx.mozDashOffset=i}}return this};this.drop=function(aV,w,i,h){if(typeof window.FileReader==="undefined"){return f("Sorry, FileReader is not supported in this browser","drop",1)}if(aV===!0&&ae===!1){this.canvas.addEventListener("dragover",d,!1);this.canvas.addEventListener("drop",e,!1);ae=!0}else{if(aV===!1&&ae===!0){this.canvas.removeEventListener("dragover",d,!1);this.canvas.removeEventListener("drop",e,!1);ae=!1}}K=(typeof w!=="undefined"&&w!==null)?w:K;J=(typeof i!=="undefined"&&i!==null)?i:J;I=(typeof h!=="undefined"&&Array.isArray(h))?h:I;return this};this.fullScreen=function(i){if((document.fullscreenenabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.oFullscreenEnabled||document.msFullscreenEnabled||(document.webkitCurrentFullScreenElement!==undefined))!==!0){return f("Fullscreen mode not supported in this browser","fullScreen",1)}if(arguments.length===0){return O}var h=ak.canvas;if(i===!0&&!h.fullscreenElement&&!h.mozFullScreenElement&&!h.webkitFullscreenElement&&!h.oFullscreenElement&&!h.msFullscreenElement){h.requestFullScreen()}else{document.cancelFullScreen()}return this};function k(h){if(h===!0){an={position:ak.style("position"),x:ak.style("left"),y:ak.style("top"),w:ak.width,h:ak.height,cssW:ak.style("width"),cssH:ak.style("height")};ak.style("position","fixed");ak.style("left","0");ak.style("top","0");switch(ak.fullScreenMode){case 0:ak.resize(screen.width,screen.height);break;case 1:ak.style("width","100%");ak.style("height","100%");break}}else{if(typeof an!=="undefined"){ak.style("position",an.position);ak.style("width",an.cssW);ak.style("height",an.cssH);ak.resize(an.w,an.h);ak.style("left",an.x);ak.style("top",an.y)}}if(typeof ak.onfullscreen==="function"){ak.onfullscreen({isFullscreen:h,timeStamp:S()})}}function g(h){h=h||window.event;var i=(document.fullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.oFullScreenElement||document.msFullScreenElement||document.webkitCurrentFullScreenElement);O=(!(i===null||i===undefined));k(O)}this.addRegion=function(aY,a3,a4,a2,aW,aZ,aV){var aX=0,a1=S();if(arguments.length===1){a3=aY.x;a4=aY.y;a2=aY.width;aW=aY.height;aZ=aY.pri;aY=aY.id;a1=aY.timeStamp;aV=aY.cursor}if(typeof aZ==="undefined"){aZ=0}if(typeof aV!=="string"){aV="default"}for(;aX<aC.length;aX++){if(aC[aX][4]===aY){return f("A region with this ID already exist","addRegion")}}aC.push([a3,a4,a2+a3,aW+a4,aY,aZ,a1,aV]);aC.sort(a0);function a0(h,i){if(h[5]===i[5]){return h[6]-i[6]}else{return h[5]-i[5]}}return this};this.updateRegion=function(aV,aY,aZ,aX,i,aW){if(arguments.length===1){ak.removeRegion(aV.id);ak.addRegion(aV)}else{ak.removeRegion(aV);if(typeof aW==="undefined"){aW=0}ak.addRegion(aV,aY,aZ,aX,i,aW)}return this};this.removeRegion=function(w){for(var h=0;h<aC.length;h++){if(aC[h][4]===w){aC.splice(h,1);return this}}return this};this.getRegion=function(w){for(var h=0;h<aC.length;h++){if(aC[h][4]===w){return aD(aC[h])}}return null};this.getRegions=function(){var h=0,w=[];for(;h<aC.length;h++){w.push(aD(aC[h]))}return w};this.testRegion=function(w,aV){var i=h(w,aV);if(i!==null){return aD(i)}else{return null}function h(aY,aZ){for(var aW=0,aX;aX=aC[aW];aW++){if(aY>=aX[0]&&aY<=aX[2]&&aZ>=aX[1]&&aZ<=aX[3]){return aX}}return null}};function aD(h){return{x:h[0],y:h[1],right:h[2],bottom:h[3],width:h[2]-h[0],height:h[3]-h[1],id:h[4],pri:h[5],timeStamp:h[6],cursor:h[7]}}this.textSelect=function(aW){var aX=(aW===!0)?"text":"none",h=document.getElementsByTagName("body")[0],w=0,aV;for(;w<ay.length;w++){aV=(w===0)?"userSelect":ay[w]+"UserSelect";h.style[aV]=aX}return this};this.addHotkey=function(aV,h,i,w){if(ak.hasHotkey(aV,h,i,w)===!0){return f("Hotkey already defined","addHotkey")}var aW=o(aV);if(aW===null){return f("Invalid key","addHotkey")}if(typeof w!=="boolean"){w=!1}if(typeof i!=="boolean"){i=!1}if(typeof h!=="boolean"){h=!1}aa.push([aV,aW,h,i,w]);if(aa.length===1){window.addEventListener("keyup",l,!1)}return this};this.hasHotkey=function(aZ,aW,aX,aY){var a0=o(aZ),aV=0,w;if(a0===null){return f("Invalid key","addHotkey")}if(typeof aY!=="boolean"){aY=!1}if(typeof aX!=="boolean"){aX=!1}if(typeof aW!=="boolean"){aW=!1}for(;w=aa[aV];aV++){if(a0===w[1]&&aW===w[2]&&aX===w[3]&&aY===w[4]){return !0}}return !1};this.removeHotkey=function(aZ,aW,aX,aY){var a0=o(aZ),aV=0,w;if(a0===null){return f("Invalid key","addHotkey")}if(typeof aY!=="boolean"){aY=!1}if(typeof aX!=="boolean"){aX=!1}if(typeof aW!=="boolean"){aW=!1}for(;w=aa[aV];aV++){if(a0===w[1]&&aW===w[2]&&aX===w[3]&&aY===w[4]){aa.splice(aV,1);if(aa.length===0){window.removeEventListener("keyup",l,!1)}return this}}return f("Hotkey not found","removeHotkey")};this.getRegionsInArea=function(a1,a2,a0,aW){if(arguments.length===1){a2=a1.y;a0=a1.width;aW=a1.height;a1=a1.x}var aX=0,aZ,aY=[],a3=a1+a0,aV=a2+aW;a3++;a1--;aV++;a2--;for(;aZ=aC[aX];aX++){if((aZ[0]>a3||aZ[2]<a1||aZ[1]>aV||aZ[3]<a2)===!1){aY.push(aD(aZ))}}return aY};function o(w){var aV=null,i={f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},aX={pgup:33,pageup:33,pgdown:34,pagedown:34,left:37,up:38,right:39,down:40,end:35,home:36,tab:9,enter:13},aW={esc:27,insert:45,del:46,"delete":46,capslock:20,winleft:91,winright:92,numlock:144,scrolllock:145,backspc:8,backspace:8,pause:19,"break":19},aY={" ":32,"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57},h={a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90};if(typeof w==="string"){if(w.length===1){if(aV===null&&aY[w]){aV=aY[w]}if(aV===null&&h[w]){aV=h[w]}}else{if(aV===null&&i[w]){aV=i[w]}if(aV===null&&aX[w]){aV=aX[w]}if(aV===null&&aW[w]){aV=aW[w]}}}else{if(typeof w==="number"){aV=parseInt(w,10)}}return aV}function l(w){if(typeof ak.onhotkey!=="function"){return}w=w||window.event;var aX=w.charCode||w.keyCode,aW=0,aV;for(;aV=aa[aW];aW++){if(aX===aV[1]&&w.altKey===aV[2]&&w.ctrlKey===aV[3]&&w.shiftKey===aV[4]){if(w.preventDefault){w.preventDefault()}w.returnValue=!1;ak.onhotkey({key:aV[0],keyCode:aV[1],isAlt:aV[2],isCtrl:aV[3],isShift:aV[4],timeStamp:w.timeStamp});return !1}}}this.cancelSelection=function(){if(ak.isDown===!0&&ak.selectionMode===!0){M(!0,null);ak.isDown=!1;return}};function d(h){h=h||window.event;h.stopPropagation();h.preventDefault();h.dataTransfer.effectAllowed="copy";h.dataTransfer.dropEffect="copy"}function e(aW){aW=aW||window.event;aW.stopPropagation();aW.preventDefault();if(typeof ak.ondrop!=="function"){return !1}var a0=aW.target.files||aW.dataTransfer.files,aY,a1,a2,a3,w=a0.length,a7=new Array(w),aZ=new Array(w),aX=[],ba=[],aV=!0,a4=0,a8,a9=1;for(;a4<w;a4++){a7[a4]=null}if(typeof ak.ondropstart==="function"){ak.ondropstart({total:a0.length,timeStamp:S()})}for(a4=0;aY=a0[a4];a4++){a1=aY.name;a2=aY.size;a3=aY.type;if(a3.indexOf("image")===0&&af(a1)===!0&&(K<0||a2<=K)&&(J<0||a4<J)){ba.push(new FileReader());a8=ba.length-1;ba[a8].___i=a4;ba[a8].___p=a9;ba[a8].___fn=a1;ba[a8].onload=h;ba[a8].readAsDataURL(aY)}else{aX.push({filename:a1,length:a2,index:a4,maxSize:K,maxItems:J});aZ[a4]=a1;w--;c(aV,a9,a0.length,null,a1);a9++;aV=!1;if(w===0){aV=!1;b(a7,aZ,aX)}}}function h(i){var bb=document.createElement("img");bb.onload=a6;bb.onerror=a5;bb.___i=this.___i;bb.___fn=this.___fn;bb.src=i.target.result}function a6(i){var bc=this.___i,bb=this.___fn;c(aV,a9,a0.length,this,bb);a9++;a7[bc]=this;aZ[bc]=bb;w--;if(w===0){aV=!1;b(a7,aZ,aX)}}function a5(i){c(aV,a9,a0.length,null,this.___fn);a9++;aZ[this.___i]=this.___fn;w--;aX.push({filename:this.___fn,length:0,index:this.___i,maxSize:K,maxItems:J});if(w===0){aV=!1;b(a7,aZ,aX)}}return !1}function af(w){var h=j(w).toLowerCase(),aV=0,aW;for(;aW=I[aV];aV++){if(aW.toLowerCase()===h){return !0}}return !1}function j(h){var w=h.length-1;while(w--){if(h.charAt(w)==="."){return h.substring(w)}}return""}function c(i,h,aX,aW,aV){if(i===!0&&typeof ak.ondropprogress==="function"){var w={current:h,total:aX,image:aW,filename:aV,timeStamp:S()};ak.ondropprogress(w)}}function b(aV,w,i){var h={images:aV,filenames:w,errors:i,total:aV.length,count:aV.length-i.length,timeStamp:S()};ak.ondrop(h)}function aB(){if(typeof ak.onredraw==="function"){if(ak.clearBeforeDraw===!0){ak.clear()}ak.onredraw(!1)}}function P(i,aV,w,aW){var h=Math.atan2(aW-aV,w-i)*az;if(h<0){h+=360}return h}function Q(h,aV,i,aW){var w=i-h,aX=aW-aV;return Math.sqrt(w*w+aX*aX)}function T(aV,w,h){var i=w-aV;if(i<=0){return 0}return h/i}function B(){var w=getComputedStyle(ak.canvas),aV,aW,h,i;aV=parseInt(w.getPropertyValue("padding-left"),10);if(isNaN(aV)===!0){aV=0}h=parseInt(w.getPropertyValue("border-left-width"),10);if(isNaN(h)===!0){h=0}aW=parseInt(w.getPropertyValue("padding-top"),10);if(isNaN(aW)===!0){aW=0}i=parseInt(w.getPropertyValue("border-top-width"),10);if(isNaN(i)===!0){i=0}ak.deltaX=aV+h;ak.deltaY=aW+i}function A(aY,aZ){var i,w,h,aV,aW,aX;C=ak.canvas.getBoundingClientRect();aW=aY-C.left-ak.deltaX;aX=aZ-C.top-ak.deltaY;aY=aW/aT;aZ=aX/aU;if(X>0){if(aY<V){aY=V}aY=(((aY+X*0.5-V)/X)|0)*X+V}if(Y>0){if(aZ<W){aZ=W}aZ=(((aZ+Y*0.5-W)/Y)|0)*Y+W}if(aE!==0){i=ak.width*ak.pivotX/aT;w=ak.height*ak.pivotY/aU;h=(P(i,w,aY,aZ)-aE)*H;aV=Q(i,w,aY,aZ);aY=i+aV*Math.cos(h);aZ=w+aV*Math.sin(h)}return[aY-ar,aZ-at,aW,aX]}function aK(){var aZ=ak.width,aW=ak.height,aY=aZ*ak.pivotX,aX=aW*ak.pivotY,a1,a0,aV,i;ak.ctx.setTransform(1,0,0,1,0,0);ak.ctx.translate(aY,aX);if(aE!==0){ak.ctx.rotate(aE*H)}ak.ctx.scale(aT,aU);ak.ctx.translate(-aY,-aX);ar=((ak.width-ak.width*aT)*ak.pivotX)/aT;at=((ak.height-ak.height*aU)*ak.pivotY)/aU;if(ak.limitPan===!0){a1=aZ/aT;a0=aW/aU;if(aT>=1){aV=aZ-a1+ar;if(aO<-aV){aO=-aV}if(aO>-ar){aO=-ar}}else{aV=a1-aZ-ar;if(aO<-ar){aO=-ar}if(aO>aV){aO=aV}}if(aU>=1){i=aW-a0+at;if(aP<-i){aP=-i}if(aP>-at){aP=-at}}else{i=a0-aW-at;if(aP<-at){aP=-at}if(aP>i){aP=i}}}ak.ctx.translate(aO,aP);aB()}function aI(){if(ak.panMode===!0){if(ak.isCursor===!1&&typeof ak.panCursor==="string"){ak.oldCursor=ak.canvas.style.cursor;ak.canvas.style.cursor=ak.panCursor;ak.isCursor=!0}}else{if(ak.isCursor===!0){ak.canvas.style.cursor=ak.oldCursor;ak.isCursor=!1}}}function ac(){if(v!==null){return}try{v=ak.getOffScreenCanvas(ak.canvas);am=null}catch(h){return f("Could not allocate buffer for autoClear.","initAutoClear")}}function M(h,i){clearInterval(aH);if(ak.selectClearFull===!1){ak.clearBackground(ap)}else{ak.clearBackground()}if(ak.autoClear===!1){ak.endAutoClear()}ak.selectedRect=(h===!1)?ap:null;ak.setDash(0);if(typeof ak.onselectend==="function"){ak.onselectend({x:ap[0],y:ap[1],width:ap[2],height:ap[3],mouseX:ap[0]+ap[2],mouseY:ap[1]+ap[3],selfDraw:!1,cancelSelection:!1,timeStamp:S(),originalEvent:i,selectionCancelled:h})}}function t(){if(ap!==null){ak.setDash(0,0,!0);ak.ctx.strokeStyle="#000";ak.ctx.strokeRect(ap[0]+0.5,ap[1]+0.5,ap[2],ap[3]);ak.setDash(5,aF++,!0);ak.ctx.strokeStyle="#fff";ak.ctx.strokeRect(ap[0]+0.5,ap[1]+0.5,ap[2],ap[3])}}function S(){return(new Date()).getTime()}try{if(this.canvas===null){this.canvas=document.createElement("canvas");this.canvas.innerHTML="easyCanvas";if(typeof this.canvas==="undefined"){return f("Could not create a canvas element.","INIT")}if(typeof aS!=="number"||typeof Z!=="number"){this.canvas.style.position="fixed";this.canvas.style.left="0";this.canvas.style.top="0";this.resize(window.innerWidth,window.innerHeight);this.autoResize=!0}else{this.canvas.width=this.width;this.canvas.height=this.height}}else{L=null}B();D=this.ctx=this.context=this.canvas.getContext("2d");if(typeof D==="undefined"){return f("Could not create a 2D canvas context.","INIT")}if(L!==null){if(typeof L==="undefined"){L=document.getElementsByTagName("body")[0]}if(typeof L==="undefined"){return f("No element is defined (body seem unavailable)","INIT")}L.appendChild(this.canvas)}}catch(N){return f("Error duing initialization of instance","INIT")}window.addEventListener("resize",s,!1);window.addEventListener("mouseup",q,!1);window.addEventListener("mousemove",p,!1);document.addEventListener("fullscreenchange",g,!1);document.addEventListener("mozfullscreenchange",g,!1);document.addEventListener("webkitfullscreenchange",g,!1);this.canvas.addEventListener(ag?"DOMMouseScroll":"mousewheel",r,!1);function s(h){h=h||window.event;if(ak.reportResize===!0){if(ak.autoResize===!0){ak.resize(window.innerWidth,window.innerHeight)}else{aB()}}}this.canvas.onmousedown=function(i){i=i||window.event;if(!("which" in i?i.which===1:i.button===1)){return}var h=A(i.clientX,i.clientY),w=h[0],aV=h[1];ak.firstX=ak.prevX=w;ak.firstY=ak.prevY=aV;ak.isDown=!0;if(ak.selectionMode===!0){ak.selectedRect=ap=null;(ak.autoClear===!0)?ak.updateAutoClear():ac();aF=0;if(typeof ak.onselectstart==="function"){ak.onselectstart({x:w,y:aV,mouseX:w,mouseY:aV,timeStamp:S(),originalEvent:i})}aH=setInterval(t,32);return}if(ak.panMode===!1){w-=aO;aV-=aP}ak.prevStamp=i.timeStamp;ak.prevAngle=0;ak.total=0;ak.maxVel=0;ak.count=1;aQ=[];aA=ak.record;aN=ak.tool;if(ak.autoClear===!0){ac()}if(aA===!0){aL=[ak.tool];aL.push(w);aL.push(aV)}if(ak.enableRegions===!0){E=ak.testRegion(w,aV);if(E!==null&&typeof ak.onregiondown==="function"){ak.onregiondown({region:E,timeStamp:i.timeStamp,x:w,y:aV})}}if(typeof ak.onmousedown==="function"){ak.onmousedown({x:w,y:aV,relativeX:h[2],relativeY:h[3],timeStamp:i.timeStamp,originalEvent:i})}ai=(typeof ak.onmousemove==="function")};function p(aX){aX=aX||window.event;if(aX.preventDefault){aX.preventDefault()}var aZ=ak,aY,w=!0,a2,h,aV,aW,i,a3,a4,a0,a1;if(aj===!1){aI()}if(aZ.isDown===!0||aZ.trackMove===!0){i=A(aX.clientX,aX.clientY);a3=i[0];a4=i[1];aV=aW=0;if(ak.selectionMode===!0){a3=parseInt(a3,10);a4=parseInt(a4,10);if(ap!==null){if(aG===!0){if(ak.selectClearFull===!1){ak.clearBackground(ap)}else{ak.clearBackground()}}else{if(ak.selectClearFull===!1){ak.clearBackground(ap[0],ap[1],ap[2],1);ak.clearBackground(ap[0],ap[1],1,ap[3]);ak.clearBackground(ap[0]+ap[2],ap[1],1,ap[3]);ak.clearBackground(ap[0],ap[1]+ap[3],ap[2],1)}else{ak.clearBackground()}}}ak.prevX=a3;ak.prevY=a4;ap=ak.getRect(parseInt(ak.firstX,10),parseInt(ak.firstY,10),parseInt(a3,10),parseInt(a4,10),!1);if(typeof ak.onselect==="function"){aY={x:ap[0],y:ap[1],width:ap[2],height:ap[3],mouseX:a3,mouseY:a4,selfDraw:!1,cancelSelection:!1,timeStamp:S(),originalEvent:aX};ak.onselect(aY);aG=aY.selfDraw;if(aY.cancelSelection===!0){M(!0,aX);ak.isDown=!1;return}}if(aG===!1){ak.setDash(0,0,!0);ak.ctx.strokeStyle="#000";ak.ctx.strokeRect(ap[0]+0.5,ap[1]+0.5,ap[2],ap[3]);ak.setDash(5,aF++,!0);ak.ctx.strokeStyle="#fff";ak.ctx.strokeRect(ap[0]+0.5,ap[1]+0.5,ap[2],ap[3])}else{clearInterval(aH)}return}if(aZ.panMode===!1){aZ.count++;aY={x:a3-aO,y:a4-aP,relativeX:i[2],relativeY:i[3],timeStamp:aX.timeStamp,originalEvent:aX,isMouseDown:aZ.isDown,count:aZ.count};if(aZ.calcAngle===!0){h=P(aZ.prevX,aZ.prevY,a3,a4);aY.angle=h;aY.relativeAngle=180-Math.abs(Math.abs(aZ.prevAngle-h)-180);aY.firstAngle=P(aZ.firstX,aZ.firstY,a3,a4);aZ.prevAngle=h}if(aZ.calcDistance===!0||aZ.calcVelocity===!0){aY.distance=Q(aZ.prevX,aZ.prevY,a3,a4);aY.firstDistance=Q(aZ.firstX,aZ.firstY,a3,a4);aY.totalDistance=(aZ.total+=aY.distance)}if(aZ.calcVelocity===!0){clearTimeout(aR);a2=T(aZ.prevStamp,aY.timeStamp,aY.distance);aY.velocity=a2;if(a2>aZ.maxVel){aZ.maxVel=a2}aQ.push(a2);aR=setTimeout(function(){aQ=[]},52)}a3-=aO;a4-=aP;if(aZ.autoClear===!0){if(aZ.trackMove===!0&&v===null){ac()}if(am!==null){ak.clearBackground(am)}am=aZ.getRect(aZ.firstX,aZ.firstY,a3,a4,!1)}if(aA===!0&&aZ.isDown===!0&&aN!==1){aL.push(a3);aL.push(a4)}if(ai===!0||typeof ak.onmousemove==="function"){aZ.onmousemove(aY)}}else{aV=a3-aZ.prevX;aW=a4-aZ.prevY;if(typeof ak.onbeforepan==="function"){ak.onbeforepan({oldDeltaX:aO,oldDeltaY:aP,newDeltaX:(aO+aV),newDeltaY:(aP+aW),isAbsolute:!1,timeStamp:S()})}a0=aO;a1=aP;aO+=aV;aP+=aW;aK();if(typeof ak.onpan==="function"){ak.onpan({oldDeltaX:a0,oldDeltaY:a1,newDeltaX:aO,newDeltaY:aP,isAbsolute:!1,timeStamp:S()})}}aZ.prevStamp=aX.timeStamp;aZ.prevX=a3;aZ.prevY=a4}else{if(aZ.enableRegions===!0&&typeof aZ.onregionover==="function"&&ak.selectionMode===!1){i=A(aX.clientX,aX.clientY);a3=i[0];a4=i[1];if(E!==null&&a3>=E.x&&a3<=E.right&&a4>=E.y&&a4<=E.bottom){return}E=ak.testRegion(a3,a4);ak.style("cursor","default");if(E!==null){ak.style("cursor",E.cursor);ak.onregionover({region:E,timeStamp:aX.timeStamp,x:a3,y:a4})}}}return !1}function q(i){i=i||window.event;if(i.preventDefault){i.preventDefault()}var h=A(i.clientX,i.clientY),aW=h[0],aX=h[1],aV,w;if(ak.isDown===!0){ak.isDown=!1;if(ak.selectionMode===!0){M(!1,i);return}w={x:aW-aO,y:aX-aP,count:ak.count,relativeX:h[2],relativeY:h[3],timeStamp:i.timeStamp,originalEvent:i};if(ak.calcAngle===!0){w.lastAngle=ak.prevAngle;w.totalAngle=w.firstAngle=P(ak.firstX,ak.firstY,aW,aX)}if(ak.calcDistance===!0){w.totalDistance=ak.total;w.firstDistance=Q(ak.firstX,ak.firstY,aW,aX)}if(ak.calcVelocity===!0){clearTimeout(aR);w.maxVelocity=ak.maxVel}if(ak.panMode===!1){aW-=aO;aX-=aP}if(ak.autoClear===!0){v=null}if(aA===!0){if(ak.strokeHeader!==null){aL.splice(1,0,ak.strokeHeader)}ak.strokes.push(aL)}if(ak.enableRegions===!0&&typeof ak.onregion==="function"){aV=ak.testRegion(aW,aX);if(E!==null&&aV!==null&&E.id===aV.id){ak.onregion({region:E,timeStamp:i.timeStamp,x:aW,y:aX})}}if(typeof ak.onmouseup==="function"){ak.onmouseup(w)}}}function r(i){if(typeof ak.onmousewheel==="function"){i=i||window.event;var h=A(i.clientX,i.clientY),w=h[0],aV=h[1];ak.onmousewheel({x:w-aO,y:aV-aP,relativeX:h[2],relativeY:h[3],delta:parseInt((i.detail?i.detail*-40:i.wheelDelta)/120,10),timeStamp:i.timeStamp,originalEvent:i});if(typeof i.preventDefault==="undefined"){return !1}else{i.preventDefault()}}}function f(i,w){if(arguments.length===3){alert('Error calling "'+w+'": '+i)}if(typeof ak.onerror==="function"){var h={};h.message=i;h.source=w;h.timeStamp=S();ak.onerror(h)}else{throw'Error calling "'+w+'": '+i}return !1}function al(h){h.forEach(a)}function a(h){switch(h.name){case"limitPan":aK();return;case"panMode":aI();return}}function m(){if(ak.onredraw===null){n--;if(n>0){setTimeout(m,10)}}else{ak.clear();ak.onredraw(!1)}}m();if(Object.observe!==undefined){Object.observe(this,al);aj=!0}return this}window.requestAnimationFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,16)}})();HTMLCanvasElement.prototype.requestFullScreen=HTMLCanvasElement.prototype.requestFullScreen||HTMLCanvasElement.prototype.webkitRequestFullScreen||HTMLCanvasElement.prototype.webkitRequestFullscreen||HTMLCanvasElement.prototype.mozRequestFullScreen||HTMLCanvasElement.prototype.oRequestFullScreen||HTMLCanvasElement.prototype.msRequestFullScreen;document.cancelFullScreen=document.cancelFullScreen||document.webkitCancelFullScreen||document.webkitCancelFullscreen||document.mozCancelFullScreen||document.oCancelFullScreen||document.msCancelFullScreen;